<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=
  , initial-scale=1.0">
  <title>CRUD utilizando FETCH</title>

  <!-- Bootstrap 5.2 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">

</head>
<body>

  <div class="container">
    <div class="mt-3">
      <h1>Productos</h1>
    </div>
    <hr>

    <div class="row mt-3">
      <div class="col-md-5">
        <!-- Formulario -->
        <form action="" id="formProducts">
          <div class="mb-3">
            <label for="nombre" class="form-label">Nombre del producto:</label>
            <input type="text" class="form-control form-control-sm" id="nombre">
          </div>
          <div class="mb-3">
            <label for="marca" class="form-label">Marca:</label>
            <input type="text" class="form-control form-control-sm" id="marca">
          </div>
          <div class="mb-3">
            <label for="precio" class="form-label">Precio:</label>
            <input type="text" class="form-control form-control-sm text-end" id="precio">
          </div>
          <div class="row">
            <div class="col-md-12">
              <button type="button" class="btn btn-success" id="guardar">Registrar producto</button>
             </div>
          </div>
        </form>
      </div>
      <div class="col-md-7">
        <!-- Tabla -->
        <table id="tbproducts" class="table table-striped table-sm">
          <thead>
            <tr>
              <th>#</th>
              <th>Nombre</th>
              <th>Marca</th>
              <th>Precio</th>
              <th>Operaciones</th>
            </tr>
          </thead>
          <tbody>

          </tbody>
        </table>
      </div> <!-- Fin de segunda columna col-7 -->
    </div> <!-- Fin de primer row -->
  </div> <!-- Fin container -->

  <script>
    document.addEventListener("DOMContentLoaded", () => {

      //Objetos
      const txName = document.getElementById("nombre");
      const txMarca = document.getElementById("marca");
      const txPrecio = document.getElementById("precio");
      const btGuardar = document.getElementById("guardar");

      const tablaProductos = document.querySelector("#tbproducts");
      const cuerpoTabla = tablaProductos.querySelector("tbody");

      //Funciones
      //Obtiene los datos de la tabla y los muesrta en <tbody>
      function renderData() {
        //Construimoa un objeto conteniendo la información a enviar
        const parametros = new URLSearchParams();
        parametros.append("operacion", "listar");
        fetch("productos.php", {
          method: 'POST',
          body: parametros
        })
          .then(response => response.json())
          .then(datos => {
            cuerpoTabla.innerHTML = "";
            datos.forEach(element => {
              const fila = `
                <tr>
                  <td>${element.idproducto}</td>
                  <td>${element.nombre}</td>  
                  <td>${element.marca}</td>  
                  <td>${element.precio}</td> 
                  <td>
                    <a href='#' class='btn btn-info btn-sm'>
                      <i class="bi bi-pen-fill"></i>
                    </a>  
                    <a href='#' class='btn btn-danger btn-sm'>
                      <i class="bi bi-trash-fill"></i>  
                    </a>  
                  </td> 
                </tr>
              `;
              cuerpoTabla.innerHTML += fila;
            });
          });

      }

      function registerProduct() {
        if (confirm("¿Estás seguro de grabar?")) {
          //Se utlizan para enviar texto/números/fechas y tambipen BINARIOS
          const fd = new FormData();
          fd.append("operacion", "registrar");
          fd.append("nombre", txName.value);
          fd.append("marca", txMarca.value);
          fd.append("precio", txPrecio.value);

          fetch("productos.php", {
            method: 'POST',
            body: fd
          })
            .then(response => response.json())
            .then(datos => {
              if (datos.status) {
                document.getElementById("formProducts").reset();
                renderData();
              } else {
                //Error detectado
                alert(datos.message);
              }
            })
        }
      }

      //Eventos
      btGuardar.addEventListener("click", registerProduct);

      //Render automáticos
      renderData();

    });
  </script>

</body>
</html>